<html lang="en" ng-app="travelBlogApp">
<head>
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate"/>
<meta http-equiv="Pragma" content="no-cache"/>
<meta http-equiv="Expires" content="0"/>

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="http://ajax.googleapis.com/ajax/libs/angular_material/1.1.0/angular-material.min.css">
  <link rel="stylesheet" href="css/styles.css">
 <link rel="stylesheet" href="https://code.getmdl.io/1.1.3/material.blue-light_blue.min.css" /> 
 <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
</head>
<body layout="row" ng-controller="AppCtrl" ng-cloak>
 
 <md-sidenav layout="column" class="md-sidenav-left md-whiteframe-z2" md-component-id="left" md-is-locked-open="$mdMedia('gt-md')">
      <md-toolbar class="md-tall md-hue-2 tb-toolbar-bg">
        <span flex></span>
        <div layout="column" class="md-toolbar-tools-bottom inset tb-toolbar-box">
          <user-avatar></user-avatar>
          <h3>Travel Blog</h3>
          <h4>Pamiętnik podróżnika</h4>
        </div>
      </md-toolbar>
      <md-list>
        
      <md-list-item ng-repeat="item in menu">
       <a ng-href="{{item.link}}" class="tb-sidebar-link" ng-click="closeSidebar()">  
          <md-item-content md-ink-ripple layout="row" layout-align="start center">
            <div class="inset">
              <ng-md-icon icon="{{item.icon}}"></ng-md-icon>
            </div>
            <div class="inset">{{item.title}}
            </div>
          </md-item-content>
        </a>
      </md-list-item>
      <md-divider></md-divider>
      <md-subheader>Tymczasowe</md-subheader>
      <md-list-item ng-repeat="item in temp">
        <a ng-href="{{item.link}}" class="tb-sidebar-link" ng-click="closeSidebar()">
          <md-item-content md-ink-ripple layout="row" layout-align="start center">
            <div class="inset">
              <ng-md-icon icon="{{item.icon}}"></ng-md-icon>
            </div>
            <div class="inset">{{item.title}}
            </div>
          </md-item-content>
        </a>
      </md-list-item>
    </md-list>
  </md-sidenav>
  
  <md-content layout-fill  layout="column"  ng-view></md-content>
        
  <script type="text/javascript" src="https://klaudiusz.eu/wordpress/wp-content/themes/twentysixteen/js/jquery-2.1.1.min.js"></script>
  <script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.5.5/angular.min.js"></script>
  <script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.5.5/angular-sanitize.min.js"></script>
  <script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.5.5/angular-animate.min.js"></script>
  <script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.5.5/angular-aria.min.js"></script>
  <script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.5.5/angular-messages.min.js"></script>
  <script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.5.5/angular-route.js"></script>
  <script src="http://ajax.googleapis.com/ajax/libs/angular_material/1.1.0/angular-material.min.js"></script>
  <script src="http://cdn.jsdelivr.net/angular-material-icons/0.7.0/angular-material-icons.min.js"></script> 
  <script src="https://developers.google.com/maps/documentation/javascript/examples/markerclusterer/markerclusterer.js"></script>
  <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCkYLhXi73VHa5nABuDwHOE8EBEA8IDnRg"> </script>
  <script type="text/javascript">    
    var app = angular.module("travelBlogApp", ["ngRoute", "ngMaterial", "ngSanitize", "ngMdIcons"]);
    
    app.config(function($routeProvider) {
        $routeProvider
        .when("/", {
            templateUrl : "places.html" 
        })
        .when("/places", {
            templateUrl : "places.html" 
        })
        .when("/place/:id", {
            templateUrl : "place.html",
            controller : "placeCtrl"
        })
        .when("/contact", {
            templateUrl : "contact.html" 
        })
        .when("/notes", {
            templateUrl : "notes.html" 
        })
        .when("/users", {
            templateUrl : "users.html" 
        }); 
    });
  
    app.controller('AppCtrl', ['$scope', '$mdBottomSheet','$mdSidenav', '$mdDialog', function($scope, $mdBottomSheet, $mdSidenav, $mdDialog){
      $scope.toggleSidenav = function(menuId) {
        $mdSidenav(menuId).toggle();
      };

      $scope.closeSidebar = function () {
            $mdSidenav('left').close();

        };
      $scope.menu = [
        {
          link : '#places',
          title: 'Miejsca',
          icon: 'place'
        },
        {
          link : '#users',
          title: 'Osoby',
          icon: 'group'
        },
        {
          link : '#contact',
          title: 'Kontakt',
          icon: 'email'
        }
      ];
      $scope.temp = [
        {
          link : '#notes',
          title: 'Notatki',
          icon: 'note'
        } 
      ];
      
      $scope.alert = '';
      $scope.showListBottomSheet = function($event) {
        $scope.alert = '';
        $mdBottomSheet.show({
          template: '<md-bottom-sheet class="md-list md-has-header"> <h2>Wybierz opcję</h2> <md-list> <md-list-item ng-repeat="item in items"> <div class="inset"><ng-md-icon icon="{{item.icon}}"></ng-md-icon></div><md-item-content md-ink-ripple flex class="inset"> <a flex aria-label="{{item.name}}" ng-click="listItemClick($index)"> <span class="md-inline-list-icon-label">{{ item.name }}</span> </a></md-item-content> </md-list-item> </md-list></md-bottom-sheet>',
          controller: 'ListBottomSheetCtrl',
          targetEvent: $event
        }).then(function(clickedItem) {
          $scope.alert = clickedItem.name + ' clicked!';
        });
      };
      
      

    }]);

    app.controller("placesCtrl", ["$scope", "$http", "$mdBottomSheet", "$mdSidenav", "$mdDialog", function($scope, $http, $mdBottomSheet, $mdSidenav, $mdDialog){
 
      $http.get('http://klaudiusz.eu/wordpress/api/get_recent_posts/').success(function(data) {
               
              }).then(function successCallback(response) {
                      
                      $scope.places = response.data.posts;
                      
                     
                      var mapOptions = {
                            zoom: 6,
                            center: new google.maps.LatLng(51.919438, 19.145136),
                            mapTypeId: google.maps.MapTypeId.TERRAIN
                        }

                        $scope.map = new google.maps.Map(document.getElementById('map'), mapOptions);

                        $scope.markers = [];
                        
                        var infoWindow = new google.maps.InfoWindow();
                        
                        var createMarker = function (info){
                         
                            var marker = new google.maps.Marker({
                                map: $scope.map,
                                position: new google.maps.LatLng(info.custom_fields.lat[0], info.custom_fields.lng[0]),
                                title: info.title,
                                thumbnail: info.thumbnail_images.tb_size.url,
                                id: info.id,
                                date: info.date,
                                excerpt: info.excerpt
                            });

                            marker.content = '<div class="infoWindowContent"><a ng-href="#place/'+info.id+'">zobacz</a></div>';
                            
                            google.maps.event.addListener(marker, 'click', function(){
                                infoWindow.setContent('<h2>' + marker.title + '</h2>' + marker.content);
                                infoWindow.open($scope.map, marker);
                            });

                           
                            $scope.markers.push(marker);
                            
                        }  
                        
                        for (i = 0; i <  response.data.posts.length; i++){
                            createMarker(response.data.posts[i]);
                                                }

                        $scope.openInfoWindow = function(e, selectedMarker){
                   
                            e.preventDefault();
                            google.maps.event.trigger(selectedMarker, 'click');
                        }
 
              }, function errorCallback(response) {
                    console.log('błąd pobierania danych');
              });
              
    }]);
 
   
 
    app.controller("placeCtrl", function ($scope, $http, $routeParams ) {
        $http.get('https://klaudiusz.eu/wordpress/wp-json/wp/v2/posts/' + $routeParams.id).success(function(data) {
          $scope.place = data;
        });
    });
    
    app.controller("contactCtrl", function ($scope) {
        $scope.msg = "Strona kontaktowa";
    });

    app.controller("notesCtrl", function ($scope) {
        $scope.msg = "Notatki";
    });

    app.controller("usersCtrl", function ($scope) {
        $scope.msg = "Osoby";
    });

    app.controller('ListBottomSheetCtrl', function($scope, $mdBottomSheet) {
      $scope.items = [
        { name: 'Udostępnij notatki', icon: 'share' },   
        { name: 'Pobierz notatki', icon: 'picture_as_pdf' },
      ];
      
      $scope.listItemClick = function($index) {
        var clickedItem = $scope.items[$index];
        $mdBottomSheet.hide(clickedItem);
      };
    });

    app.config(function($mdThemingProvider) {
      var customBlueMap =     $mdThemingProvider.extendPalette('light-blue', {
        'contrastDefaultColor': 'light',
        'contrastDarkColors': ['50'],
        '50': 'ffffff'
      });
      $mdThemingProvider.definePalette('customBlue', customBlueMap);
      $mdThemingProvider.theme('default')
        .primaryPalette('customBlue', {
          'default': '500',
          'hue-1': '50'
        })
        .accentPalette('pink');
      $mdThemingProvider.theme('input', 'default')
            .primaryPalette('grey')
    }); 

    function DialogController($scope, $mdDialog) {
      $scope.hide = function() {
        $mdDialog.hide();
      };
      $scope.cancel = function() {
        $mdDialog.cancel();
      };
      $scope.answer = function(answer) {
        $mdDialog.hide(answer);
      };
    };

    app.directive('userAvatar', function() {
      return {
        replace: true,
        template: '<img width="70" ng-src="images/klaudiusz.jpg" alt="klaudiusz" class="user-avatar">'
      };
    });
  </script>
  
   
</body>
</html>